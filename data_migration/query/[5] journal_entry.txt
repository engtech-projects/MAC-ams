TRUNCATE TABLE journal_entry;
INSERT INTO journal_entry ( ref_no, journal_date, branch_id, book_id, source, cheque_date, cheque_no, amount, STATUS, remarks,
	payee ) (
	SELECT
		REF_NO,
		TRAN_DATE AS "journal_date",
		( SELECT b.branch_id FROM branch b WHERE b.branch_code = gl.PER_CODE ) AS "branch_id",
		( SELECT book_id FROM journal_book jb WHERE jb.book_code = gl.BOOK_CODE ) AS "book_id",
		SOURCE AS "source",
		CHECK_DATE AS "cheque_date",
		CHECK_NO AS "checque_no",
		AMOUNT AS "amount",
	IF
		( POSTED = "P", "posted", "unposted" ) AS "status",
		CONCAT(PART1,' ',PART2) AS "remark",
		PAY_REF AS "payee"
	FROM
		glhead gl 
	);
UPDATE journal_entry AS a
INNER JOIN journal_entry AS b ON a.journal_id = b.journal_id 
SET a.journal_no = CONCAT( ( SELECT book_code FROM journal_book WHERE book_id = b.book_id ), "-", LPAD( b.ref_no, 7, 0 ) );